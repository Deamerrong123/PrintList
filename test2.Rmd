---
title: "R Notebook"
output: html_notebook
---
|Market Scenario|Probability|K1 (w1 = .3)|K2 (w2 = .2)|K3 (w3 = .5|
|-----|----------|------------|------------|-----------|
|w1 |.2 |.3 |.1|-.2|
|w2|.3|-.1|.3|.3|
|w3|.4|.2|-.1|.3|
|w4|.1|-.2|-.4|-.1|


$$C^{-1} =
 \begin{bmatrix}
 32 & 2.6 & 6.1 \\
 2.6 & 22 & -4.3 \\
 6.1 & -4.3 & 24
 \end{bmatrix}$$

```{r}
c.inv <- matrix(c(32,2.6,6.1,2.6,22,-4.3,6.1,-4.3,24),nrow = 3, byrow = T)
```

1) Compute the expected return of each asset.
```{r}
Scenario <- t(c(.2,.3,.4,.1))

W <- t(c(.3,.2,.5))

k1<- t(c(.3,-.1,.2,-.2))
k2 <- t(c(.1,.3,-.1,-.4))
k3 <- t(c(-.2,.3,.3,-.1))

mu_k1 <- Scenario %*% t(k1)
mu_k2 <- Scenario %*% t(k2)
mu_k3 <- Scenario %*% t(k3)

m <- matrix(c(mu_k1 ,mu_k2,mu_k3),nrow = 1)
m
```


2)Compute the convariance matrix amount assets by filling the missing entries in C.

$$c = 
\begin{bmatrix}
C_{1\ 1} & C_{1\ 2} & C_{1\ 3} \\
C_{2\ 1} & C_{2\ 2} & C_{2\ 3} \\
C_{3\ 1} & C_{3\ 2} & C_{3\ 3} \\
\end{bmatrix}$$

$$Var(K_j) = \sum_{i=1}^{N}{(K_i-\mu_{K_j})^2\cdot p_i} \\
Cov(J,K) = \sum_{i=1}^{N}{(J_i-\mu_J)(K_i-\mu_K) \cdot p_i}$$


3) compute the expected return and risk of the porfolio.

$$
c = 
\begin{bmatrix}
.033 & -.0057 & -.0094 \\
-.0057&.048&.01 \\
-.0094 & .01 & .046 \\
\end{bmatrix}
$$

$$
\mu_v = W \cdot \mu_k
$$


```{r}
c <- matrix(c(.0329,-.0057,-.0094,-.0057,.0481,.0102,-.0094,.0102,.0464),nrow = 3 , byrow = T)
m_v <- round(m %*% t(W),2)
val_v <- round(sqrt(W %*% c%*% t(W)),2)
m_v
val_v
```


4) compute the weights of the MVP. Compute the expeted return and risk of the MVP

$$
u = [1\ \ 1\ \ 1];\\
W_{MVP}  = \frac{u\cdot C^{-1}}{u \cdot C^{-1} \cdot u^T}; \\
\mu_{MVP} = W_{MVP} \cdot m; \\
\sigma_{MVP} = W_{MVP} \cdot C^{-1} \cdot (W_{MVP})^T; \\
$$

```{r}
u <- t(c(1,1,1))
w.mvp <- round((u%*%c.inv)/as.vector(u%*%c.inv%*%t(u)),2)
m.mvp <- round(w.mvp %*% t(m),3)
val.mvp <- round(sqrt(w.mvp %*% c %*% t(w.mvp)),2)
w.mvp
m.mvp
val.mvp
```


5) find the weights for the MVL. It is given that

$$ M^{-1} = 
\begin{bmatrix}
5.3 & -.51 \\
-.51 & .061 \\
\end{bmatrix}$$

$$\begin{bmatrix}
\lambda_1\\
\lambda_1
\end{bmatrix}
= M^{-1}
\begin{bmatrix}
\mu\\
1
\end{bmatrix}
\\
\lambda_1 = 5.3\mu -.51 \ \ \ \lambda _2 = .061 - .051\\
w_{MVP} = \lambda_1 m\cdot C^{-1} + \lambda_2uC^{-1} \\
w_{MVP} = a\mu + b$$

```{r}
M.inv <- matrix(c(5.3,-.51,-.51,.061), nrow = 2 , byrow =T)
a <- round(M.inv[1,1] * m %*% c.inv + M.inv[2,1] * u %*% c.inv,3)
b <- round(M.inv[1,2] * m %*% c.inv + M.inv[2,2] * u %*% c.inv,2)
a
b
```

$$w_{MVL} = [0.093\ \ -9.26\ \ 9.4]\mu + [0.48 \ \ 1.13\ \ -0.60].$$


6. Find the equation of the effcient frontier. The product between $W_{MVL}$ and C is given

$$w_{MVL} \cdot C = [.015-0.038\mu\ , .046-.35\mu\ , .34\mu - .021]$$

$$\sigma = \sqrt{w_{MVL} \cdot C \cdot w_{MVL}^{T}} = \\
\sqrt{[.015-0.038\mu\ , .046-.35\mu\ , .34\mu - .021] \cdot [0.093\mu+.48\ , -9.26\mu + 1.13\, 9.4\mu - .60]^{T}} = \\ 
\sqrt{6.4\mu^2 - 1.2\mu + .071}$$


7) Given the risk-free return R = .05, compute the weights of the market portfolio.

$$w_{MVL} = \frac{(m - R*u)\cdot C^{-1}}{(m - R*u)\cdot C^{-1}\cdot u^T}$$

```{r}
R <- .05
w.m <- round((((m-R*u)%*%c.inv)/as.vector((m-R*u)%*%c.inv%*%t(u))),2)
mu.m <- round(w.m %*% t(m),2)
val.m <- round(sqrt(w.m %*% c %*% t(w.m)),2)
w.m
mu.m
val.m
```

8) Compute the expected return and risk of the market portfolio. You can use weight in above or use the efficient frontier.

Method 1 (Use $W_M$).

$$\mu_M = w_{market\ portolio} \cdot m \\
\sigma = w_{market\ portolio} \cdot C \cdot (w_{market\ portolio})^{T}$$


```{r}
mu.m <- round(w.m %*% t(m),2)
val.m <- round(sqrt(w.m %*% c %*% t(w.m)),2)
mu.m
val.m
```

Method 2. Use the efficient frontier. Treate $\sigma$ as the y variable $\mu$ as the x variable.

$$ \frac{d\sigma}{d\mu} = \frac{1}{2} \frac{2 \times 6.4-1.2}{\sqrt{6.4\mu^2 - 1.2\mu + .071}}$$

The CML passes through ($\sigma_M,\mu_M$) and has the form
$$ \sigma - \sigma_M = \frac{d\sigma}{d\mu}|_{M}(\mu - \mu_M)$$

The CML also passes through (R,0), leading to
$$0 - \sigma_M = \frac{d\sigma}{d\mu}|_{M}(\mu - \mu_M)$$

Therefore,

$$-\sqrt{6.4\mu_m^2 - 1.2 \mu_M + .071} = \frac{1}{2} \frac{2 \times 6.4-1.2}{\sqrt{6.4\mu^2 - 1.2\mu + .071}} (R - \mu_M) ,$$

Which has a solution

$$\mu_M = .15$$


9) Compute the return of the market portfolio

$$K_M = []$$


10) Find the equation of the CML

$$\mu = \frac{\mu_M - R}{\sigma_M} + R = \frac{.15 - .05}{.16} + .05 = .63\sigma + .05$$


where $.63\sigma$ is called the risk premium.


11) Consider a feasible portfolio with allocation w = [.2  .4  .4]. It is given that $Cov(K_M,K_V = .01$. Compute its $\beta_V$.

Method 1.

$$\beta_V = \frac{Cov(K_M,K_V)}{\sigma^2_M}$$


```{r}
beta.v <- .01/val.m^2
beta.v
```


Method 2.

$$\beta_V = \frac{\mu_V - R}{\mu_M - R}.$$


```{r}
w.v <- t(c(.2,.4,.4))
mu.v <- w.v %*% t(m)
beta.v <- (mu.v-R)/(mu.m - R)
mu.v
beta.v
```


12) Write down the CAPM equation for the above portfolio.

$$K_V = \beta K_M + \alpha + \epsilon\ ,$$

where

$$K_V = [.02\ , .22\ , -.24]\, K_M = [-.025\ , .11\ , .33\ , -.087]$$

and 

$$\hat{\beta} = \beta_V\ , \hat{\alpha} = \mu_v - \beta_V \mu_M\ , E\epsilon = 0.$$

13) Consider a portfolio on the CML with .09 of risk. Compute its $\beta_V$.

$$\beta_V = \frac{\sigma_V}{\sigma_M} $$

```{r}
val.cml <- .09
new.beta.v <- val.cml/val.m
new.beta.v
```


14) If you want to achieve 20% of expected return using the three securities in the table, what is your allocation with the minimum variance?

```{r}
mu.ex <- .20
w.mvl <- mu.ex * a + b
w.mvl %*% t(m)
```


[?
```{r}
w.fv <- t(c(.48,.30,.25))
w.fv %*% t(m)
```
?]


15) How would you allocate the capital amoung risky assets and the risk-free asset if you would like to achieve 9% of expected return with the minimum variance?

$$0.05w_1 + 0.15(1-w_1) = 0.09 \\
-> w_1 = .6, w_2 = .4$$


16) Write down the equation of the SML.

$$\mu_V = \beta_V(\mu_M - R) + R = \beta_V = \beta_V(0.15 - .05) + 0.05 = 0.10\beta_V + 0.5$$


















